{% extends 'home.html' %}
{% block title %}Edit Expense{% endblock %}

{% block head %}
    <title>Edit Expense</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Flatpickr CSS & JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <!-- styling links -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css' )}}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/edit.css')}}">
    <!-- javascript links -->
    <script type="text/javascript" src="{{ url_for('static', filename='js/home.js')}}" defer></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/edit.js')}}" defer></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/flash.js')}}" defer></script>
{% endblock %}

{% block content %}
<main>
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-content">
            <a href="{{ url_for('expenses') }}" class="back-btn" aria-label="Go back to expenses">
                <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="currentColor"><path d="M640-80 240-480l400-400 71 71-329 329 329 329-71 71Z"/></svg>
            </a>
            <div class="header-text">
                <h1>Edit Expense</h1>
                <p class="sow-info">
                    <span class="sow-id">{{ expense.invoice_number if expense else 'New' }}</span>
                    <span class="separator">â€¢</span>
                    <span class="breed">{{ expense.category if expense else '' }}</span>
                </p>
            </div>
        </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class="flashes">
                {% for category, message in messages %}
                <li class="flash {{ category|lower }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <!-- Edit Form Card -->
    <div class="form-card">
        <div class="form-card-header">
            <div class="header-icon expense-icon">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M444-200h70v-50q50-9 86-39t36-89q0-42-24-77t-96-61q-60-20-83-35t-23-41q0-26 18.5-41t53.5-15q32 0 50 15.5t26 38.5l64-26q-11-35-40.5-61T516-710v-50h-70v50q-50 11-78 44t-28 74q0 47 27.5 76t86.5 50q63 23 87.5 41t24.5 47q0 33-23.5 48.5T486-314q-33 0-58.5-20.5T390-396l-66 26q14 48 43.5 77.5T444-252v52Z"/></svg>
            </div>
            <div class="header-info">
                <h2>Update Expense Details</h2>
                <p>Modify the expense information and save your changes</p>
            </div>
        </div>

        <form class="edit-form" method="POST">
            {{ form.hidden_tag() }}
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="date">
                        <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="currentColor"><path d="M200-80q-33 0-56.5-23.5T120-160v-560q0-33 23.5-56.5T200-800h40v-80h80v80h320v-80h80v80h40q33 0 56.5 23.5T840-720v560q0 33-23.5 56.5T760-80H200Zm0-80h560v-400H200v400Z"/></svg>
                        <span>Date</span>
                    </label>
                    {{ form.date(class="form-input", autocomplete="off", id="expense_date", placeholder="Select date") }}
                    <span class="field-hint">When did this expense occur?</span>
                </div>

                <div class="form-group">
                    <label for="amount">
                        <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="currentColor"><path d="M441-120v-86q-53-12-91.5-46T293-348l74-30q15 48 44.5 73t77.5 25q41 0 69.5-18.5T587-356q0-35-22-55.5T463-458q-86-27-118-64.5T313-614q0-65 42-101t86-41v-84h80v84q45 6 77.5 29.5T650-googl74l-74 30q-12-32-34-48t-60-16q-44 0-67 19.5T392-614q0 33 30 52t104 40q69 20 104.5 63.5T666-googl356q0 71-42 108t-103 46v82h-80Z"/></svg>
                        <span>Amount</span>
                    </label>
                    {{ form.amount(class="form-input", autocomplete="off", placeholder="0.00") }}
                    <span class="field-hint">Total expense amount</span>
                </div>

                <div class="form-group">
                    <label for="invoice_number">
                        <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="currentColor"><path d="M240-80q-50 0-85-35t-35-85v-120h120v-560l60 60 60-60 60 60 60-60 60 60 60-60 60 60 60-60 60 60 60-60v680q0 50-35 85t-85 35H240Z"/></svg>
                        <span>Receipt Number</span>
                    </label>
                    {{ form.invoice_number(class="form-input", autocomplete="off", placeholder="Enter receipt number") }}
                    <span class="field-hint">Invoice or receipt reference</span>
                </div>

                <div class="form-group">
                    <label for="category">
                        <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="currentColor"><path d="M280-600v-80h560v80H280Zm0 160v-80h560v80H280Zm0 160v-80h560v80H280ZM160-600q-17 0-28.5-11.5T120-640q0-17 11.5-28.5T160-680q17 0 28.5 11.5T200-640q0 17-11.5 28.5T160-600Zm0 160q-17 0-28.5-11.5T120-480q0-17 11.5-28.5T160-520q17 0 28.5 11.5T200-480q0 17-11.5 28.5T160-440Zm0 160q-17 0-28.5-11.5T120-320q0-17 11.5-28.5T160-360q17 0 28.5 11.5T200-320q0 17-11.5 28.5T160-280Z"/></svg>
                        <span>Category</span>
                    </label>
                    {{ form.category(class="form-input", autocomplete="off", placeholder="e.g., Feed, Medication") }}
                    <span class="field-hint">Type of expense</span>
                </div>

                <div class="form-group">
                    <label for="vendor">
                        <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="currentColor"><path d="M160-720v-80h640v80H160Zm0 560v-240h-40v-80l40-200h640l40 200v80h-40v240h-80v-240H560v240H160Zm80-80h240v-160H240v160Z"/></svg>
                        <span>Vendor</span>
                    </label>
                    {{ form.vendor(class="form-input", autocomplete="off", placeholder="Enter vendor name") }}
                    <span class="field-hint">Where was this purchased?</span>
                </div>

                <div class="form-group form-group-full">
                    <label for="description">
                        <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="currentColor"><path d="M320-240h320v-80H320v80Zm0-160h320v-80H320v80ZM240-80q-33 0-56.5-23.5T160-160v-640q0-33 23.5-56.5T240-880h320l240 240v480q0 33-23.5 56.5T720-80H240Z"/></svg>
                        <span>Description</span>
                    </label>
                    {{ form.description(class="form-input form-textarea", autocomplete="off", placeholder="Enter expense description...", rows="3") }}
                    <span class="field-hint">Additional details about this expense</span>
                </div>
            </div>

            <div class="form-actions">
                <a href="{{ url_for('expenses') }}" class="btn btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="currentColor"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg>
                    <span>Cancel</span>
                </a>
                <button type="submit" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="currentColor"><path d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z"/></svg>
                    <span>Save Changes</span>
                </button>
            </div>
        </form>
    </div>

    <!-- Current Values Card (if editing existing expense) -->
    {% if expense %}
    <div class="info-card">
        <div class="info-card-header">
            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="currentColor"><path d="M480-280q17 0 28.5-11.5T520-320v-160q0-17-11.5-28.5T480-520q-17 0-28.5 11.5T440-480v160q0 17 11.5 28.5T480-280Zm0-320q17 0 28.5-11.5T520-640q0-17-11.5-28.5T480-680q-17 0-28.5 11.5T440-640q0 17 11.5 28.5T480-600Zm0 520q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"/></svg>
            <span>Current Values</span>
        </div>
        <div class="info-card-content info-card-grid">
            <div class="info-item">
                <span class="info-label">Date</span>
                <span class="info-value">{{ expense.date.strftime('%d-%b-%Y') if expense.date else 'Not set' }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Amount</span>
                <span class="info-value amount-value">{{ "%.2f"|format(expense.amount) if expense.amount else '0.00' }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Receipt #</span>
                <span class="info-value">{{ expense.invoice_number or 'Not set' }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Category</span>
                <span class="info-value">{{ expense.category or 'Not set' }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Vendor</span>
                <span class="info-value">{{ expense.vendor or 'Not set' }}</span>
            </div>
            <div class="info-item info-item-full">
                <span class="info-label">Description</span>
                <span class="info-value">{{ expense.description or 'No description' }}</span>
            </div>
        </div>
    </div>
    {% endif %}
</main>

<script>
    flatpickr("#expense_date", {
        dateFormat: "d-m-Y",
        maxDate: "today"
    }); 
</script>
{% endblock %}